# Project Overview  
Проект для управления книгами и их выдачей в библиотеке.  
Приложение позволяет регистрировать библиотекарей, управлять книгами и читателями, а также выдавать и возвращать книги. Для безопасности используется JWT-аутентификация.

# Features  
- Регистрация и логин библиотекарей.  
- Получение JWT access token после логина.  
- операции для книг, читателей.
- Выдача книги читателю с проверками наличия экземпляров и ограничением не более 3 книг на одного читателя.  
- Возврат книги с обновлением статуса и количества экземпляров.  
- Получение списка всех книг (публичный эндпоинт, без JWT).  
- Получение списка книг, выданных конкретному читателю (защищено JWT).

# Authentication  
- Эндпоинты регистрации, просмотра книг и логина библиотекарей доступны без токена.  
- Все остальные операции требуют валидный JWT access token в заголовке Authorization.  
- Пароли хранятся в хешированном виде (используется библиотека passlib[bcrypt]).  
- JWT-токены генерируются с помощью python-jose.

# Business Logic  
- Книга может быть выдана, только если доступно количество экземпляров > 0. При выдаче количество уменьшается на 1.  
- Один читатель не может иметь более 3 одновременно взятых книг.  
- При возврате книги количество экземпляров увеличивается на 1.  
- Нельзя вернуть книгу, которая не была выдана этому читателю или уже возвращена.

# Database Structure (кратко)  
- Таблица Users (библиотекари) с email и хешем пароля.  
- Таблица Books с полями id, название, автор, год, ISBN, количество экземпляров, description.  
- Таблица Readers с id, именем и email.  
- Таблица BorrowedBooks для учета выдачи книг: id, book_id, reader_id, borrow_date, return_date.

# Migrations  
- Используется Alembic для управления миграциями базы данных.  
- Есть начальная миграция для создания всех таблиц.  
- Вторая миграция добавляет поле description в таблицу книг и обновляет данные.

# Test Cases Summary  
- Проверка регистрации и логина с получением JWT.  
- Проверка создания, обновления и удаления книг.  
- Проверка создания читателя.  
- Проверка выдачи книги с учетом наличия и ограничения по количеству книг на читателя.  
- Проверка невозможности выдать уже занятую книгу.  
- Проверка возврата книги и корректного обновления статусов.  
- Проверка доступа к защищенным эндпоинтам с и без JWT.

# Compilation & Run

1- Создайте и активируйте виртуальное окружение:
```
python -m venv venv  
source venv/bin/activate  # Linux/macOS  
venv\Scripts\activate     # Windows  
pip install -r requirements.txt  
```
2- Запуск приложения
`python main.py`

3- Запустите тесты командой:

`python -m pytest`
